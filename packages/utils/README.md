# @microbuild/utils

Utility functions for Microbuild UI packages. Includes field interface mapping, value formatting, and validation helpers.

## Installation

```bash
pnpm add @microbuild/utils
```

## Features

### Field Interface Mapper

Maps database field types to appropriate UI interface components. Supports both explicit interface definitions (from Directus `meta.interface`) and type-based inference.

```tsx
import { 
  getFieldInterface, 
  getFieldDefault, 
  getFieldValidation,
  isFieldReadOnly,
  formatFieldValue 
} from '@microbuild/utils';

// Get the interface component type for a field
const interfaceConfig = getFieldInterface(field);
// Returns: { type: 'input', props: { type: 'string', maxLength: 255 } }

// Check if field should be read-only
const readOnly = isFieldReadOnly(field, 'create');
// Returns: true for auto-increment PKs, UUID PKs, etc.

// Get validation rules
const validation = getFieldValidation(field);
// Returns: { required: true, maxLength: 255 }

// Format value for display
const displayValue = formatFieldValue(value, field);
// Returns: formatted string based on field type
```

### Supported Interface Types

| Interface | Description |
|-----------|-------------|
| `input` | Single-line text input |
| `input-code` | Code editor with syntax highlighting |
| `input-multiline` | Multi-line textarea |
| `input-autocomplete-api` | API-backed autocomplete |
| `input-block-editor` | Block-based content editor |
| `boolean` | Boolean toggle/switch |
| `datetime` | Date/time picker |
| `select-dropdown` | Dropdown select |
| `select-radio` | Radio button selection |
| `select-icon` | Icon picker |
| `select-color` | Color picker |
| `slider` | Numeric range slider |
| `tags` | Tag input with presets |
| `presentation-divider` | Visual section divider |
| `presentation-notice` | Notice/alert display |
| `list-m2o` | Many-to-One relationship |
| `list-o2m` | One-to-Many relationship |
| `list-m2m` | Many-to-Many relationship |
| `list-m2a` | Many-to-Any relationship |
| `file` | Single file upload |
| `file-image` | Image file with preview |
| `files` | Multiple file upload |
| `map` | Geometry/map input |
| `collection-item-dropdown` | Collection item selector |
| `workflow-button` | Workflow state transitions |

### Read-Only Detection

The `isFieldReadOnly` function determines if a field should be read-only based on:

- `meta.readonly` flag from backend/permissions
- Auto-increment primary keys (always read-only)
- UUID primary keys in edit mode
- Fields with database-generated defaults (`gen_random_uuid()`, `now()`, etc.)
- Special behaviors (`date-created`, `date-updated`, `user-created`, etc.)

```tsx
import { isFieldReadOnly, isUUIDAutoGenerated, getAutoGenerationType } from '@microbuild/utils';

// Check if field is read-only in create context
isFieldReadOnly(field, 'create');

// Check if field is read-only in edit context with primary key
isFieldReadOnly(field, { context: 'edit', primaryKey: 'abc-123' });

// Check if UUID field has auto-generated value
isUUIDAutoGenerated(field); // true for UUID PKs

// Get the auto-generation type
getAutoGenerationType(field); // 'auto-increment' | 'uuid' | 'timestamp' | 'user' | null
```

### Presentation Fields

Check if a field is presentation-only (no data storage):

```tsx
import { isPresentationField } from '@microbuild/utils';

if (isPresentationField(field)) {
  // Skip validation, don't include in form data
}
```

## API Reference

### `getFieldInterface(field: Field): InterfaceConfig`

Maps a field to its interface component type and props.

### `isFieldReadOnly(field: Field, context: 'create' | 'edit' | FieldReadOnlyOptions): boolean`

Determines if a field should be read-only.

### `getFieldValidation(field: Field): ValidationRules`

Extracts validation rules from field schema.

### `getFieldDefault(field: Field): unknown`

Gets the default value for a field (excluding function-generated defaults).

### `formatFieldValue(value: unknown, field: Field): string`

Formats a field value for display.

### `isUUIDAutoGenerated(field: Field): boolean`

Checks if a UUID field has auto-generated values.

### `hasAutoGeneratedDefault(field: Field): boolean`

Checks if a field has any auto-generated default value.

### `getAutoGenerationType(field: Field): string | null`

Gets the type of auto-generation for a field.

### `isPresentationField(field: Field): boolean`

Checks if a field is presentation-only.

## License

MIT
